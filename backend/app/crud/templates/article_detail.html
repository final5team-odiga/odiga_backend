<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>{{ article.articleTitle }}</title>
    <style>
      .like-button {
        padding: 8px 16px;
        border-radius: 4px;
        cursor: pointer;
        border: 1px solid #ccc;
        margin-top: 10px;
        margin-bottom: 10px;
        display: inline-flex;
        align-items: center;
        gap: 5px;
      }
      
      .like-button.liked {
        background-color: #ffebee;
        color: #e53935;
        border-color: #e53935;
      }
      
      .like-info {
        margin-top: 10px;
        margin-bottom: 10px;
        display: inline-flex;
        align-items: center;
        gap: 5px;
        color: #666;
      }
    </style>
  </head>
  <body>
    {% set current_user = request.session.get('user') %}
    <!-- â”€â”€ ê²Œì‹œê¸€ ìƒì„¸ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <h1>{{ article.articleTitle }}</h1>
    <p><strong>Author:</strong> {{ article.articleAuthor }}</p>
    <p><strong>Country:</strong> {{ article.travelCountry }}</p>
    <p><strong>City:</strong> {{ article.travelCity }}</p>
    {% if article.imageURL %}
      <img
        src="{{ article.imageURL }}"
        alt="Article image"
        style="max-width: 300px"
      />
    {% endif %}
    {% if article.shareLink %}
      <p><a href="{{ article.shareLink }}" target="_blank">ê³µìœ  ë§í¬</a></p>
    {% endif %}
    {% if article.price %}
      <p><strong>Price:</strong> ${{ article.price }}</p>
    {% endif %}
    <p>
      <small>
        Created at {{ article.createdAt.strftime("%Y-%m-%d %H:%M") }}
        <!-- Created at <span class="local-time" data-time="{{ article.createdAt.isoformat() }}"></span> -->
      </small>
    </p>

    <!-- ì¢‹ì•„ìš” ë²„íŠ¼ ì¶”ê°€ -->
    {% if current_user %}
      <button id="likeButton" 
              class="like-button {% if user_liked %}liked{% endif %}"
              data-article-id="{{ article.articleID }}">
        <span id="likeIcon">{% if user_liked %}â¤ï¸{% else %}ğŸ¤{% endif %}</span>
        <span id="likesCount">{{ article.likes }}</span> Likes
      </button>
    {% else %}
      <div class="like-info">
        <span>â¤ï¸</span> <span id="likesCount">{{ article.likes }}</span> Likes (ë¡œê·¸ì¸ í›„ ì¢‹ì•„ìš”ë¥¼ ëˆ„ë¥¼ ìˆ˜ ìˆìŠµë‹ˆë‹¤)
      </div>
    {% endif %}

    <!-- ê¸€ ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼: ë¡œê·¸ì¸ & ë³¸ì¸ ì‘ì„±ìì¸ ê²½ìš°ì—ë§Œ ë…¸ì¶œ -->
    {% if current_user and current_user == article.articleAuthor %}
      <a href="/articles/{{ article.articleID }}/edit">ìˆ˜ì •</a>
      <form
        action="/articles/{{ article.articleID }}/delete"
        method="post"
        style="display: inline"
      >
        <button
          type="submit"
          onclick="return confirm('ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');"
        >
          ì‚­ì œ
        </button>
      </form>
    {% endif %}

    <p><a href="/articles/">ëª©ë¡ìœ¼ë¡œ</a></p>
    <hr />

    <!-- â”€â”€ ëŒ“ê¸€ ì„¹ì…˜ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    <h2 id="comments">ëŒ“ê¸€ ({{ comments|length }})</h2>

    {% if comments %}
      <ul>
        {% for c in comments %}
          <li style="margin-bottom: 1em;">
            <p>
              <strong>{{ c.commentAuthor }}</strong>
              <em>({{ c.createdAt.strftime("%Y-%m-%d %H:%M") }})</em>
            </p>
            <p>{{ c.content }}</p>
            <!-- ëŒ“ê¸€ ìˆ˜ì •/ì‚­ì œ ë²„íŠ¼: ë¡œê·¸ì¸ & ë³¸ì¸ ì‘ì„±ìì¼ ë•Œë§Œ -->
            {% if current_user and current_user == c.commentAuthor %}
              <p>
                <a href="/articles/{{ article.articleID }}/comments/{{ c.commentID }}/edit">
                  ìˆ˜ì •
                </a>
                <form
                  action="/articles/{{ article.articleID }}/comments/{{ c.commentID }}/delete"
                  method="post"
                  style="display: inline;"
                >
                  <button
                    type="submit"
                    onclick="return confirm('ì´ ëŒ“ê¸€ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?');"
                  >
                    ì‚­ì œ
                  </button>
                </form>
              </p>
            {% endif %}
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p>ë“±ë¡ëœ ëŒ“ê¸€ì´ ì—†ìŠµë‹ˆë‹¤.</p>
    {% endif %}

    <hr />

    <!-- â”€â”€ ìƒˆ ëŒ“ê¸€ ì‘ì„± í¼ â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ -->
    {% if current_user %}
      <h3>ìƒˆ ëŒ“ê¸€ ì‘ì„±</h3>
      <form action="/articles/{{ article.articleID }}/comments" method="post">
        <!-- commentAuthor í•„ë“œë¥¼ ìˆ¨ê¹€ìœ¼ë¡œ ì²˜ë¦¬í•˜ì—¬ ì„¸ì…˜ê°’ì„ ì‚¬ìš© -->
        <input
          type="hidden"
          name="commentAuthor"
          value="{{ current_user }}"
        />
        <label>
          Comment:
          <br />
          <textarea
            name="content"
            rows="4"
            cols="50"
            placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”"
            required
          ></textarea>
        </label>
        <br /><br />
        <button type="submit">ëŒ“ê¸€ ë‹¬ê¸°</button>
      </form>
    {% else %}
      <p><a href="/login/">ë¡œê·¸ì¸</a> í›„ ëŒ“ê¸€ì„ ì‘ì„±í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</p>
    {% endif %}

    <!-- ì¢‹ì•„ìš” ê¸°ëŠ¥ JavaScript -->
    <script>
      document.addEventListener('DOMContentLoaded', function() {
        const likeButton = document.getElementById('likeButton');
        if (likeButton) {
          likeButton.addEventListener('click', function() {
            const articleId = this.getAttribute('data-article-id');
            
            // ì¢‹ì•„ìš” ìš”ì²­ ë³´ë‚´ê¸°
            fetch(`/articles/${articleId}/like`, {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
            })
            .then(response => response.json())
            .then(data => {
              if (data.success) {
                // ì¢‹ì•„ìš” ìƒíƒœì— ë”°ë¼ ë²„íŠ¼ ëª¨ì–‘ ì—…ë°ì´íŠ¸
                if (data.liked) {
                  likeButton.classList.add('liked');
                  document.getElementById('likeIcon').textContent = 'â¤ï¸';
                } else {
                  likeButton.classList.remove('liked');
                  document.getElementById('likeIcon').textContent = 'ğŸ¤';
                }
                
                // ì¢‹ì•„ìš” ìˆ˜ ì—…ë°ì´íŠ¸
                document.getElementById('likesCount').textContent = data.likes_count;
              } else {
                // ì—ëŸ¬ ì²˜ë¦¬
                alert(data.message || 'ì¢‹ì•„ìš” ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
              }
            })
            .catch(error => {
              console.error('Error:', error);
              alert('ì¢‹ì•„ìš” ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
            });
          });
        }
      });
    </script>
  </body>
</html>